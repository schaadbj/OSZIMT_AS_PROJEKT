package application;


import java.sql.SQLException;
import java.util.List;
import java.util.Scanner;

//KLASSE ZUR KUNDENVERWALTUNG (Menüpunkt 2)

public class IO_kuverw {
	static Scanner sc = new Scanner(System.in);
//====Neuer Kunde====	
		public static void neuobj() throws SQLException {
			//Eingaben
			System.out.println("\n----------Neuen Kunden hinzufügen-----------");                                            //--Eingabe Beginn
		    System.out.print("\nVorname: ");
		    String vname=sc.next();
		    System.out.print("\nNachname: ");
		    String nname=sc.next();
		    System.out.print("\n---Adresse--- ");
		    System.out.print("\nStraße: ");
		    String str=sc.next();
		    System.out.print("\nNummer: ");
		    int strnr=sc.nextInt();
		    System.out.print("\nPLZ: ");
		    int plz=sc.nextInt();
		    System.out.print("\nOrt: ");
		    String ort=sc.next();
		    //nächste freie ID wird aus DB geladen
		    String sqlquery = Sqlquery.getKunden();
		    List<O_Kunde> kunden=DBconnection.showDBku(sqlquery);
		    int id=1;
		    try {
		    	id=kunden.get(kunden.size()-1).getId()+1;
		    }	    	
		    catch (ArrayIndexOutOfBoundsException e) {//kunden.size()-1 wirft diese Exception wenn das Array Kunden keine Elemente enthält (Size=0)
		    	System.out.println("\nDies ist der erste Datensatz, ID=1");
		    }
		    catch (NullPointerException e) {
		    	System.out.println("\nNullPointerException");
		    }
		
		    //Kunden Objekt erstellen
		    O_Kunde kunde = new O_Kunde(id, plz, strnr, vname, nname, str, ort);
		    String newKunde = Sqlquery.newKunde(id, nname, vname, str, strnr, plz, ort);
		    DBconnection.updateDB(newKunde);
		    
		    //Ausgabe Check
		    System.out.println("\nSie haben folgenden Kunden hinzugefügt:");                                                     
		    System.out.println("Kundennummer: "+kunde.getId());
		    System.out.println("Name: "+kunde.getNname()+ ", " +kunde.getVname());
		    System.out.println("Adresse: "+kunde.getStr()+" "+kunde.getStrnr()+", "+kunde.getPlz()+" "+kunde.getOrt()); 
		    IO_MainMenu.fortfahren();
		}//end of method neuobj
		
//====Kunde löschen====		
		public static void delobj() throws SQLException {	                                         
		    int i=0, id = 0, ende = 0;
		    
		    //erzeuge ArrayList mit allen in DB(t_kunden) vorhandenen Einträgen
		    String sqlquery = Sqlquery.getKunden();
		    List<O_Kunde> kunden=DBconnection.showDBku(sqlquery);
		    
		    
		    System.out.println("\n----------Kunde entfernen-----------");
			System.out.print("\nGeben Sie die Kundennummer ein: ");
			id=sc.nextInt();
			
			//Prüfung ob ID vergeben
			while (i==0) {
				for (O_Kunde kunde: kunden) { //foreach Schleife, für jedes Kundenobjekt in Array Kunden
					if (id==kunde.getId())  i=1;
				}//end of for
				if (i==0) {
					System.out.print("\nDie eingegebene Kundenummer existiert nicht. Geben Sie eine andere ein: (0=Beenden)");
					id=sc.nextInt();
				}
				if (id==0) {ende=1;break;}//ende=1 weil User beenden ausgewählt hat
			}//end of while	
			
			//Überprüfung ob User 0=beenden ausgewählt hat
			if (ende==1) IO_MainMenu.fortfahren();
			else {
				//Löschen bestätigen
				i=0;
				while (i==0) {
					System.out.println("Löschen bestätigen (Y/N)");
					char del=sc.next().toLowerCase().charAt(0);
					switch (del) {
					case 'y' : //wird gelöscht
						i=1;
						String delete = Sqlquery.delKunde(id);
						DBconnection.updateDB(delete);
						System.out.println("Erfolgreich gelöscht");
						break;
					case 'n' : //wird nicht gelöscht
						i=1;
						System.out.println("Löschen beendet");
						break;
					default:
						i=0;
					}//end of switch
				}//end of while
				IO_MainMenu.fortfahren();
			}//end of else
		}//end of method delobj
		
//====Bestimmten Kunden anzeigen====	
		public static void showobj() throws SQLException {
			int i=0;
			
			//erzeuge ArrayList mit allen in DB(t_kunden) vorhandenen Einträgen
			String sqlquery = Sqlquery.getKunden();
			List<O_Kunde> kunden=DBconnection.showDBku(sqlquery);
			
			
			System.out.println("\n----------Anzeigen eines Kunden-----------");
			System.out.print("\nGeben Sie die Kundennummer ein:");
			int id=sc.nextInt();
			
			//Überprüfung ob Kundennummer vorhanden
			while (i==0) {	
				for (O_Kunde kunde: kunden) { //foreach Schleife, für jedes Kundenobjekt in Array Kunden
					if (id==kunde.getId()) { //wenn Kundenobjekt mit gesuchter ID gefunden wird
						i=1;
						System.out.println("Kundennummer: "+id);
						System.out.println("Name: "+kunde.getNname()+ ", " +kunde.getVname());
						System.out.println("Adresse: "+kunde.getStr()+" "+kunde.getStrnr()+", "+kunde.getPlz()+" "+kunde.getOrt());
						break;
					}//end of if
				}//end of for
				if (i==0) {
					System.out.print("\nDie eingegebene Kundenummer existiert nicht. Geben Sie eine andere ein: (0=Beenden)");
					id=sc.nextInt();
				}//end of if			
				if (id==0) break; //wenn User 0=beenden gewählt hat
			}//end of while	
			IO_MainMenu.fortfahren();
		}//end of method showobj
		
//====Alle Kunden anzeigen====			
		public static void showall() throws SQLException {
			//erzeuge ArrayList mit allen in DB(t_kunden) vorhandenen Einträgen
			String allkunden = Sqlquery.getKunden();
			List<O_Kunde> kunden=DBconnection.showDBku(allkunden);
			System.out.println("\n----------Anzeigen aller Kunden-----------");
			for (O_Kunde kunde1: kunden) { //foreach Schleife, für jedes Kundenobjekt in Array Kunden
					System.out.println("Kundennummer: "+kunde1.getId());
					System.out.println("Name: "+kunde1.getNname()+ ", " +kunde1.getVname());
					System.out.println("Adresse: "+kunde1.getStr()+" "+kunde1.getStrnr()+", "+kunde1.getPlz()+" "+kunde1.getOrt()+"\n");
			}
		    IO_MainMenu.fortfahren();
	}//end of method showall

}
